<div fxLayout="row wrap">
  <div fxFlex.gt-sm="70" fxFlex.gt-xs="70" fxFlex="100" class="clearfix">
    <form [formGroup]="userCreditReportForm">
      <div fxLayout="row wrap" class="mar-btm selectcontainer">
        <div fxFlex.gt-sm="100">
          <div fxFlex.gt-sm="33" *ngIf="_roleCode=='SA' || _roleCode=='PA' || _roleCode=='DA'">
            <mat-form-field class="full-width rightpad-45">
              <mat-select placeholder="{{'ReportsModule.UserCreditReports.UserType'|translate}}" required
                formControlName="typeWise" (selectionChange)="userTypeChange(true)" required>
                <mat-option [value]="0">
                  {{'ReportsModule.UserCreditReports.DepartmentWise'|translate}}</mat-option>
                <mat-option [value]="1">{{'ReportsModule.UserCreditReports.UserWise'|translate}}</mat-option>
                <mat-option [value]="2" *ngIf="_roleCode=='SA' || _roleCode=='PA'">
                  {{'ReportsModule.UserCreditReports.PlatFormWise'|translate}}</mat-option>
              </mat-select>
              <mat-error *ngIf="userCreditReportForm.controls.typeWise.errors?.required">
                {{'ReportsModule.UserCreditReports.UserTypeError'|translate}}</mat-error>
            </mat-form-field>
          </div>
          <div fxFlex.gt-sm="33"
            *ngIf=" (_roleCode=='SA' || _roleCode=='PA') && userCreditReportForm.value.typeWise!='2'">
            <mat-form-field class="full-width rightpad-45">
              <mat-select multiple placeholder="{{'ReportsModule.UserCreditReports.selectDepart'|translate}}"
                (selectionChange)="departmentChange()" required formControlName="departmentName" required>
                <mat-select-trigger> 
                  {{deptName}}
                  <span *ngIf="(userCreditReportForm?.value.departmentName)?.length>
                    1" class="example-additional-selection">
                    (+{{(userCreditReportForm?.value.departmentName)?.length - 1}} others)
                  </span>
                </mat-select-trigger>
                <mat-option *ngFor="let dept of deptUsersList" [value]="dept.deptId">{{dept.deptName}}</mat-option>
              </mat-select>
              <mat-error *ngIf="userCreditReportForm.controls.departmentName.errors?.required">
                {{'ReportsModule.UserCreditReports.departError'|translate}}</mat-error>
            </mat-form-field>
          </div>
          <div fxFlex.gt-sm="33" *ngIf="_roleCode!='NA' && userCreditReportForm.value.typeWise=='1'">
            <mat-form-field class="full-width rightpad-45">
              <mat-select multiple placeholder="{{'ReportsModule.UserCreditReports.selectUser'|translate}}" required
                formControlName="creditUser" (selectionChange)="UserSelection()">
                <mat-select-trigger> 
                  {{userName ? userName : ''}}
                  <span *ngIf="(userCreditReportForm?.value.creditUser)?.length>
                    1" class="example-additional-selection">
                    (+{{(userCreditReportForm?.value.creditUser)?.length - 1}} others)
                  </span>
                </mat-select-trigger>
                <mat-option *ngFor="let user of  usersList" [value]="user.userId">{{user?.login}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="userCreditReportForm.controls.creditUser.errors?.required">
                {{'ReportsModule.UserCreditReports.userError'|translate}}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
        <div fxFlex.gt-sm="100">
          <div fxFlex.gt-sm="33" class="full-width rightpad-45">
            <mat-form-field class="full-width ">
              <input matInput [matDatepicker]="picker" placeholder="{{'ActionNames.from'|translate}}"
                formControlName="fromDate" parse-format="MM/dd/yyyy" readonly (focus)="picker.open()" [min]="fromDate"
                [max]="userCreditReportForm.value.toDate ? userCreditReportForm.value.toDate : toDate" required>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <mat-error *ngIf="userCreditReportForm.controls.fromDate.errors">
                <div *ngIf="userCreditReportForm.controls.fromDate.errors.required">
                  {{'ActionNames.startDate'|translate}}
                </div>
              </mat-error>
            </mat-form-field>
          </div>
          <div fxFlex.gt-sm="33" class="full-width rightpad-45">
            <mat-form-field class="full-width ">
              <input matInput [matDatepicker]="picker2" placeholder="{{'ActionNames.to'|translate}}"
                formControlName="toDate" readonly (focus)="picker2.open()" required
                [min]="userCreditReportForm.value.fromDate ? userCreditReportForm.value.fromDate : fromDate"
                [max]="toDate">
              <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
              <mat-datepicker #picker2></mat-datepicker>
              <mat-error *ngIf="userCreditReportForm.controls.toDate.errors">
                <div *ngIf="userCreditReportForm.controls.toDate.errors.required">
                  {{'ActionNames.endDate'|translate}}
                </div>
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div fxLayout="row wrap" class="clearfix">
          <button mat-raised-button class="submitbutton" (click)="onSubmit()"
            [disabled]="userCreditReportForm.invalid">{{'ActionNames.submit'|translate}}</button>
        </div>
      </div>


    </form>
  </div>

  <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100"
    *ngIf="deptCreditReportList?.length > 0 && creditlistFlag == 0">
    <h2 class="pageheading">{{'ReportsModule.UserCreditReports.deptCreditsReports'|translate}}</h2>
    <div fxLayout="row wrap" class="mar-btm">

      <div fxFlex="60"></div>
      <div fxFlex="40" class="search-align">
        <span class="export">{{'ActionNames.export'|translate}}</span>

        <button mat-icon-button (click)="ExportTOExcel()"><img src="assets/images/excel.svg" width="30"
            height="30"></button>
        <button mat-icon-button (click)="ExportTOCsv()"><img src="assets/images/csv.svg" width="30"
            height="30"></button>
        <button mat-icon-button (click)="ExportTOPdf()"><img src="assets/images/pdf.svg" width="30"
            height="30"></button>
      </div>
    </div>

    <div fxLayout="row wrap">
      <div class="example-container mat-elevation-z8 no-shadow bord-all" style="width:100%">
        <table mat-table [dataSource]="deptdataSource" class="full-width-table listtable" matSort
          (matSortChange)="sortData()">

          <!-- <ng-container matColumnDef="Date">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
      <td mat-cell *matCellDef="let element">{{element.Date | date :'yyyy-MM-dd'}}</td>
      </ng-container>-->

          <ng-container matColumnDef="deptName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-column-department">
              {{'ReportsModule.UserCreditReports.departname'|translate}}</th>
            <td mat-cell *matCellDef="let element" class="mat-column-department"> {{ element.deptName}} </td>
          </ng-container>

          <ng-container matColumnDef="creditName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.creditName'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.creditName}} </td>
          </ng-container>

          <ng-container matColumnDef="newValue">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.newValue'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.newValue}} </td>
          </ng-container>

          <ng-container matColumnDef="oldValue">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.oldValue'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.oldValue}} </td>
          </ng-container>

          <ng-container matColumnDef="transactionName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.transactionName'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.transactionName}} </td>
          </ng-container>

          <ng-container matColumnDef="actionDoneByUser">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.actionByUser'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.actionDoneByUser}} </td>
          </ng-container>

          <ng-container matColumnDef="updatedOn">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.updatedon'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.updatedOn}} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="deptwisedisplayColumns"></tr>
          <tr mat-row *matRowDef="let row; let i = index; columns: deptwisedisplayColumns;"></tr>
        </table>
        <div *ngIf="deptCreditReportList?.length>pageSize">
          <mat-paginator [length]="deptCreditReportList?.length" [pageSize]="pageSize" [pageIndex]="listPage"
            showFirstLastButtons (page)="getListData($event)">
          </mat-paginator>
        </div>
      </div>
    </div>


  </div>
  <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100" *ngIf="creditReportsFlag && deptCreditReportList?.length==0">
    <span>{{'ActionNames.notFound'|translate}}</span>
  </div>
  <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100"
    *ngIf="userCreditReportList?.length > 0 && creditlistFlag == 1">
    <h2 class="pageheading">{{'ReportsModule.UserCreditReports.userCreditsReports'|translate}}</h2>
    <div fxLayout="row wrap" class="mar-btm">

      <div fxFlex="60"></div>
      <div fxFlex="40" class="search-align">

        <span class="export">{{'ActionNames.export'|translate}}</span>

        <button mat-icon-button (click)="ExportTOExcel()"><img src="assets/images/excel.svg" width="30"
            height="30"></button>
        <button mat-icon-button (click)="ExportTOCsv()"><img src="assets/images/csv.svg" width="30"
            height="30"></button>
        <button mat-icon-button (click)="ExportTOPdf()"><img src="assets/images/pdf.svg" width="30"
            height="30"></button>
      </div>
    </div>

    <div fxLayout="row wrap">
      <div class="example-container mat-elevation-z8 no-shadow bord-all" style="width:100%">
        <table mat-table [dataSource]="userdataSource" class="full-width-table listtable" matSort
          (matSortChange)="sortData()">

          <!-- <ng-container matColumnDef="Date">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
        <td mat-cell *matCellDef="let element">{{element.Date | date :'yyyy-MM-dd'}}</td>
        </ng-container>-->

          <ng-container matColumnDef="userName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-column-department">
              {{'ReportsModule.UserCreditReports.userName'|translate}}</th>
            <td mat-cell *matCellDef="let element" class="mat-column-department"> {{element.userName}} </td>
          </ng-container>

          <ng-container matColumnDef="creditName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.creditName'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.creditName}} </td>
          </ng-container>

          <ng-container matColumnDef="newValue">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.newValue'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.newValue}} </td>
          </ng-container>

          <ng-container matColumnDef="oldValue">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.oldValue'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.oldValue}} </td>
          </ng-container>

          <ng-container matColumnDef="transactionName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.transactionName'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.transactionName}} </td>
          </ng-container>

          <ng-container matColumnDef="updatedOn">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.updatedon'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.updatedOn}} </td>
          </ng-container>

          <ng-container matColumnDef="actionDoneByUser">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.actionByUser'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.actionDoneByUser}} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="userwisedisplayColumns"></tr>
          <tr mat-row *matRowDef="let row; let i = index; columns: userwisedisplayColumns;"></tr>
        </table>
        <div *ngIf="userCreditReportList?.length>pageSize">
          <mat-paginator [length]="userCreditReportList?.length" [pageSize]="pageSize" [pageIndex]="listPage"
            showFirstLastButtons (page)="getListData($event)">
          </mat-paginator>
        </div>
      </div>
    </div>


  </div>
  <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100"
    *ngIf="usercreditReportsFlag && userCreditReportList?.length==0">
    <span>{{'ActionNames.notFound'|translate}}</span>
  </div>
  <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100" *ngIf="platFormCreditList?.length > 0 && creditlistFlag == 2">
    <h2 class="pageheading">{{'ReportsModule.UserCreditReports.PlatformCreditsReports'|translate}}</h2>
    <div fxLayout="row wrap" class="mar-btm">

      <div fxFlex="60"></div>
      <div fxFlex="40" class="search-align">

        <span class="export">{{'ActionNames.export'|translate}}</span>

        <button mat-icon-button (click)="ExportTOExcel()"><img src="assets/images/excel.svg" width="30"
            height="30"></button>
        <button mat-icon-button (click)="ExportTOCsv()"><img src="assets/images/csv.svg" width="30"
            height="30"></button>
        <button mat-icon-button (click)="ExportTOPdf()"><img src="assets/images/pdf.svg" width="30"
            height="30"></button>
      </div>
    </div>

    <div fxLayout="row wrap">
      <div class="example-container mat-elevation-z8 no-shadow bord-all" style="width:100%">
        <table mat-table [dataSource]="platformdataSource" class="full-width-table listtable" matSort
          (matSortChange)="sortData()">

          <ng-container matColumnDef="creditName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.creditName'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.creditName}} </td>
          </ng-container>

          <ng-container matColumnDef="newValue">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.newValue'|translate}}
            </th>
            <td mat-cell *matCellDef="let element">{{element.newValue}} </td>
          </ng-container>

          <ng-container matColumnDef="oldValue">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.oldValue'|translate}}
            </th>
            <td mat-cell *matCellDef="let element">{{element.oldValue}} </td>
          </ng-container>

          <ng-container matColumnDef="transactionName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.transactionName'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.transactionName}} </td>
          </ng-container>

          <ng-container matColumnDef="updatedOn">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.updatedon'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.updatedOn}} </td>
          </ng-container>

          <ng-container matColumnDef="actionDoneByUser">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'ReportsModule.UserCreditReports.actionByUser'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.actionDoneByUser}} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="platformwisedisplayColumns"></tr>
          <tr mat-row *matRowDef="let row; let i = index; columns: platformwisedisplayColumns;"></tr>
        </table>
        <div *ngIf="platFormCreditList?.length>pageSize">
          <mat-paginator [length]="platFormCreditList?.length" [pageSize]="pageSize" [pageIndex]="listPage"
            showFirstLastButtons (page)="getListData($event)">
          </mat-paginator>
        </div>
      </div>
    </div>
  </div>
  <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100"
    *ngIf="usercreditReportsFlag && platFormCreditList?.length==0">
    <span>{{'ActionNames.notFound'|translate}}</span>
  </div>
</div>
<div class="fullloader" *ngIf="loading">
  <div class="fullloaderInner">
    <img src="assets/images/loading.gif">
  </div>
</div>