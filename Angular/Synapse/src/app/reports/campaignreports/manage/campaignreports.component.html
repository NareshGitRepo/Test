<h2 class="pageheading">{{'ReportsModule.CampaignReports.campaignReports'|translate}}</h2>

<div fxLayout="row wrap">
  <div fxFlex.gt-sm="70" fxFlex.gt-xs="70" fxFlex="100" class="clearfix">
    <form [formGroup]="campaignReportsForm">

      <div fxLayout="row wrap" class="mar-btm selectcontainer">

            <div fxFlex.gt-sm="33" *ngIf="_roleCode=='SA' || _roleCode=='PA'">
                <mat-form-field class="full-width rightpad-45">
                  <mat-select placeholder="{{'ReportsModule.userType'|translate}}" (selectionChange)="userTypeSelection()"
                    formControlName="typeOfUsers" required>
                    <mat-option  [value]="0">{{'ReportsModule.DeptUsers'|translate}}</mat-option>
                    <mat-option  [value]="1">{{'ReportsModule.GlobalUsers'|translate}}</mat-option>
                    <!-- <mat-option value="IT">IT</mat-option> -->
                  </mat-select>
                  <mat-error *ngIf="campaignReportsForm.controls.typeOfUsers.errors?.required">{{'ReportsModule.userTypeError'|translate}}</mat-error>
    
                </mat-form-field>
              </div>
          <div fxFlex.gt-sm="33" *ngIf="(_roleCode=='SA' || _roleCode=='PA') && campaignReportsForm?.value.typeOfUsers=='0'">
            <mat-form-field class="full-width rightpad-45">
              <mat-select multiple placeholder="{{'ReportsModule.CampaignReports.selectDepart'|translate}}" (selectionChange)="departSelected()"
                formControlName="campaignDepartment" required>
                <mat-select-trigger> 
                    {{deptName}}
                    <span *ngIf="(campaignReportsForm?.value.campaignDepartment)?.length>
                      1" class="example-additional-selection">
                      (+{{(campaignReportsForm?.value.campaignDepartment)?.length - 1}} others)
                    </span>
                  </mat-select-trigger>
                <mat-option *ngFor="let dept of departmentWithUsersList" [value]="dept">{{dept.deptName}}</mat-option>
                <!-- <mat-option value="IT">IT</mat-option> -->
              </mat-select>
              <mat-error *ngIf="campaignReportsForm.controls.campaignDepartment.errors?.required">{{'ReportsModule.CampaignReports.departError'|translate}}</mat-error>

            </mat-form-field>
          </div>

          <div fxFlex.gt-sm="33" *ngIf="_roleCode!='NA'">
            <mat-form-field class="full-width rightpad-45">
              <mat-select multiple placeholder="{{'ReportsModule.CampaignReports.selectUser'|translate}}" required formControlName="campaignUser" (selectionChange)="UserSelection()">
                  <mat-select-trigger> 
                      {{userName ? userName : ''}}
                      <span *ngIf="(campaignReportsForm?.value.campaignUser)?.length>
                        1" class="example-additional-selection">
                        (+{{(campaignReportsForm?.value.campaignUser)?.length - 1}} others)
                      </span>
                    </mat-select-trigger>
                    <mat-option *ngFor="let user of (campaignReportsForm?.value.typeOfUsers=='0'? usersList: globalUsers)" [value]="user.userId">{{user?.login}} 
                      </mat-option>
              </mat-select>
              <mat-error *ngIf="campaignReportsForm.controls.campaignUser.errors?.required">{{'ReportsModule.CampaignReports.userError'|translate}}
              </mat-error>
            </mat-form-field>
          </div>

        <div fxFlex.gt-sm="100">
          <div fxFlex.gt-sm="33">
            <mat-form-field class="full-width rightpad-45">
              <mat-select autofocus cdkFocusInitial placeholder="{{'ReportsModule.CampaignReports.selectDate'|translate}}"
                (selectionChange)="DateSelection($event.value)" formControlName="dateType" required>
                <mat-option *ngFor="let datetype of DateType" [value]="datetype.id">
                  {{datetype.type}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="campaignReportsForm.controls.dateType.errors?.required">{{'ReportsModule.CampaignReports.dateError'|translate}}
              </mat-error>
            </mat-form-field>
          </div>

          <div fxFlex.gt-sm="66" *ngIf="isToday">
              <div fxFlex.gt-sm="50">
                <mat-form-field class="full-width rightpad-45">
                  <input matInput [matDatepicker]="picker" required placeholder="{{'ActionNames.from'|translate}}" formControlName="campaignFromDate"
                    parse-format="MM/dd/yyyy" readonly (focus)="picker.open()" [min]="campaignFromDate"
                    [max]="campaignReportsForm.value.campaignToDate ? campaignReportsForm.value.campaignToDate : campaignToDate">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                  <mat-error *ngIf="campaignReportsForm.controls.campaignFromDate.errors">
                    <div *ngIf="campaignReportsForm.controls.campaignFromDate.errors.required">
                      {{'ActionNames.startDate'|translate}}
                    </div>
                  </mat-error>
                </mat-form-field>
              </div>
  
              <div fxFlex.gt-sm="50">
                <mat-form-field class="full-width rightpad-45">
                  <input matInput [matDatepicker]="picker2" required placeholder="{{'ActionNames.to'|translate}}" formControlName="campaignToDate" readonly
                    (focus)="picker2.open()"
                    [min]="campaignReportsForm.value.campaignFromDate ? campaignReportsForm.value.campaignFromDate : campaignFromDate"
                    [max]="campaignToDate">
                  <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                  <mat-datepicker #picker2></mat-datepicker>
                  <mat-error *ngIf="campaignReportsForm.controls.campaignToDate.errors">
                    <div *ngIf="campaignReportsForm.controls.campaignToDate.errors.required">
                      {{'ActionNames.endDate'|translate}}
                    </div>
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
        </div>
        <!-- {{campaignReportsForm.value |json}} -->
        <div fxFlex.gt-sm="100">
          <div fxFlex.gt-sm="33.3">
            <button mat-raised-button class="submitbutton" (click)="onSubmit()"
              [disabled]="campaignReportsForm.invalid">{{'ActionNames.submit'|translate}}</button>
          </div>
        </div>

      </div>


    </form>
  </div>

  <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100" *ngIf="campaignReportList.length>0">


    <div fxLayout="row wrap" class="mar-btm">
      <div fxFlex="60"></div>
      <div fxFlex="40" class="search-align">
        <span class="export">{{'ActionNames.export'|translate}} </span>

       
        <button mat-icon-button (click)="ExportTOExcel()"><img src="assets/images/excel.svg" width="30" height="30"
            ></button>
        <button mat-icon-button (click)="ExportTOCsv()"><img src="assets/images/csv.svg" width="30" height="30"
            ></button>
            <button mat-icon-button (click)="ExportTOPdf()"><img src="assets/images/pdf.svg" width="30" height="30"></button>
      </div>
    </div>

    <div fxLayout="row wrap">
      <div class="example-container mat-elevation-z8 no-shadow bord-all" style="width:100%">
        <table mat-table [dataSource]="dataSource" class="full-width-table listtable" matSort (matSortChange)="sortData()">

          <ng-container matColumnDef="Date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'ReportsModule.CampaignReports.date'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{convertData(element.Date) | date :'yyyy-MM-dd'}}</td>
          </ng-container>

          <ng-container matColumnDef="CampaignId">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'ReportsModule.CampaignReports.campaignId'|translate}}</th>
            <td mat-cell *matCellDef="let element"> {{element.CampaignId}} </td>
          </ng-container>

          <ng-container matColumnDef="CampaignName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'ReportsModule.CampaignReports.campaignName'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.CampaignName}} </td>
          </ng-container>

          <ng-container matColumnDef="Department">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'ReportsModule.CampaignReports.departname'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.Department}} </td>
          </ng-container>

          <ng-container matColumnDef="UserName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'ReportsModule.CampaignReports.userName'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.UserName}} </td>
          </ng-container>

          <ng-container matColumnDef="Uploaded">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'ReportsModule.CampaignReports.uploaded'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.Uploaded }}</td>
          </ng-container>

          <ng-container matColumnDef="Sent">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'ReportsModule.CampaignReports.sent'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.Sent }}</td>
          </ng-container>

          <ng-container matColumnDef="Delivered">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'ReportsModule.CampaignReports.delivered'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.Delivered }}</td>
          </ng-container>

          <ng-container matColumnDef="Failed">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'ReportsModule.CampaignReports.failed'|translate}}</th>
            <td mat-cell *matCellDef="let element">{{element.Failed }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumns;"></tr>
        </table>

        <div *ngIf="campaignReportList.length>pageSize">

          <mat-paginator [length]="campaignReportList.length" [pageSize]="pageSize" [pageIndex]="listPage"
            showFirstLastButtons (page)="getListData($event)">
          </mat-paginator>

        </div>
      </div>
    </div>


  </div>
  <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100" *ngIf="gridLoad && campaignReportList.length==0">
    <span>{{'ActionNames.notFound'|translate}}</span>
  </div>
</div>

<div class="fullloader" *ngIf="loading">
  <div class="fullloaderInner">
    <img src="assets/images/loading.gif">
  </div>
</div>